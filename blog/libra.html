<!DOCTYPE html>
<html lang="en" data-bulma-theme="light">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="icon" href="../img/favicon.ico" sizes="32x32">
  <link rel="icon" href="../img/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="../img/apple-touch-icon.png">

  <meta property="og:title" content="Compile time dimensional analysis with Libra" />
  <meta property="og:image" content="../img/logo.png" />

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.28/dist/katex.min.css"
    integrity="sha384-Wsr4Nh3yrvMf2KCebJchRJoVo1gTU6kcP05uRSh5NV3sj9+a8IomuJoQzf3sMq4T" crossorigin="anonymous">
  

  <link rel="stylesheet" href="../main.css">
  <link rel="stylesheet" href="../css/code.css">
  <script src="../main.js"></script>

  <title>Compile time dimensional analysis with Libra</title>
</head>

<body class="bulma-is-flex bulma-is-flex-direction-column">
  <nav class="bulma-navbar" role="navigation" aria-label="main navigation">
  <div class="bulma-navbar-brand">
    <a class="bulma-navbar-item" href="../">
      <img src="../img/logo.svg" />
    </a>

    <a role="button" class="bulma-navbar-burger" aria-label="menu" aria-expanded="false" data-target="navMenu"
      onClick="handleBurgerClick(this)">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div class="bulma-navbar-menu" id="navMenu">
    <div class="bulma-navbar-start">

    </div>
    <div class="bulma-navbar-end">
      <!-- <div class="bulma-navbar-item"><a class="bulma-button bulma-is-rounded bulma-is-primary bulma-has-text-light">Get Started</a></div> -->
      <!-- <div class="bulma-navbar-item"><a class="bulma-button bulma-is-text">Learn</a></div> -->
      <div class="bulma-navbar-item"><a class="bulma-button bulma-is-text" href="../projects/">Projects</a></div>
      <div class="bulma-navbar-item"><a class="bulma-button bulma-is-text" href="../community/">Community</a></div>
      <div class="bulma-navbar-item"><a class="bulma-button bulma-is-text" href="../foundation/">Foundation</a></div>
      <div class="bulma-navbar-item"><a class="bulma-button bulma-is-text" href="index.html">Blog</a></div>
      <div class="bulma-navbar-item">
        <a id="search-top-bar" class="bulma-button bulma-is-text" aria-label="Search" onclick="showSearchModal()">
          <span class="bulma-icon bulma-is-small bulma-is-size-6">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376C296.3 401.1 253.9 416 208 416 93.1 416 0 322.9 0 208S93.1 0 208 0 416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/></svg>
          </span>
        </a>
      </div>
    </div>
  </div>
</nav>

<!-- Search Modal -->
<div id="search-modal" class="bulma-modal bulma-is-justify-content-flex-start bulma-pt-6 bulma-pb-6">
  <div class="bulma-modal-background bulma-is-align-items-flex-start" onclick="hideSearchModal()"></div>
  <div class="bulma-modal-card">
    <header class="bulma-modal-card-head">
      <p class="bulma-control bulma-has-icons-left bulma-is-flex-grow-1">
        <input id="search-input" class="bulma-input bulma-is-medium bulma-is-primary" type="search" autocomplete="off" oninput="onSearchInput(event)">
        <span class="bulma-icon bulma-is-left bulma-has-text-primary">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376C296.3 401.1 253.9 416 208 416 93.1 416 0 322.9 0 208S93.1 0 208 0 416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/></svg>
        </span>
      </p>
    </header>
    <section id="search-results" class="bulma-modal-card-body">
    </section>
    <footer class="bulma-modal-card-foot bulma-is-justify-content-space-between">
      <span class="bulma-has-text-grey bulma-is-size-7">
        <kbd class="bulma-tag">/</kbd> to open search &nbsp;
        <kbd class="bulma-tag">Esc</kbd> to close
      </span>
    </footer>
  </div>
</div>

  <main class="bulma-is-flex-grow-1">
    
<section class="bulma-hero bulma-is-primary bulma-is-bold">
  <div class="bulma-hero-body bulma-container bulma-is-max-desktop">
    <p class="bulma-title bulma-has-text-light">Compile time dimensional analysis with Libra</p>
    <p class="blog-post-byline bulma-has-text-light bulma-subtitle">
      by
      
        Zainab Ali<span class="delimiter">,</span><span class="last-delimiter"> &</span>
      
      on June 13, 2017
    </p>
     
      <span class="bulma-tag">technical</span>
     
  </div>
</section>
<div class="bulma-section bulma-container bulma-is-max-desktop">
  <div class="blog-post bulma-content">
    <h1 id="compile-time-dimensional-analysis-with-libra" class="title">Compile time dimensional analysis with Libra</h1>
    
    <h2 id="dimensional-analysis" class="section"><a class="anchor-link" href="#dimensional-analysis"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Dimensional analysis</h2>
    <p>When we code, we code in numbers - doubles, floats and ints.  Those numbers always represent real world quantities.</p>
    <p>For example, the number of people in a room can be represented as an integer, as can the number of chairs.
    Adding people and chairs together gives a nonsensical result, but dividing the number of people by the number of chairs gives a useful indicator of how full up the room is.</p>
    <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">numberOfPeople</span><span> = </span><span class="number-literal">9</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">numberOfChairs</span><span> = </span><span class="number-literal">10</span><span>
</span><span class="identifier">numberOfPeople</span><span> + </span><span class="identifier">numberOfChairs</span><span> </span><span class="comment">// this is a bug
</span><span class="identifier">numberOfPeople</span><span>.</span><span class="identifier">toDouble</span><span> / </span><span class="identifier">numberOfChairs</span><span>.</span><span class="identifier">toDouble</span><span> </span><span class="comment">// this is useful</span></code></pre>
    <p>This is actually a form of dimensional analysis.  We&#39;re mentally assigning the dimension <code>Person</code> to the quantity of people, and <code>Chair</code> to the quantity of chairs.  Dimensional analysis can be summarized in two laws.</p>
    <ol class="arabic">
      <li>Quantities can only be added or subtracted to quantities of the same dimension</li>
      <li>Quantities of different dimensions can be multiplied or divided</li>
    </ol>
    
    <h3 id="why-is-it-important" class="section"><a class="anchor-link" href="#why-is-it-important"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Why is it important?</h3>
    <p>Ignoring the laws can result in serious problems.
    Take the Mars Climate Orbiter, a $200 million space probe which successfully reached Mars after a year long voyage, but suddenly crashed into the Martian atmosphere on arrival.  Most components on the orbiter were using metric units, however a single component was sending instructions in Imperial units.  The other components did not detect this, and instead began a sudden descent causing the orbiter to burn up.  This was a simple unit conversion error!  It was a basic mistake that could have been easily avoided.  It should have been picked up during testing, or in the runtime validation layer.</p>
    <p>In fact, it could even have been caught at compile time.</p>
    
    <h3 id="compile-time-dimensional-analysis" class="section"><a class="anchor-link" href="#compile-time-dimensional-analysis"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Compile time dimensional analysis</h3>
    <p>We&#39;re going to use a similar problem to demonstrate compile time dimensional analysis.
    To fit with the theme of rocket physics, we will tackle a rocket launch towards the distant constellation of Libra.
    We&#39;ll begin by working through our calculation in doubles before adding compile time safety with dependent types and finally supporting compile time dimensional analysis with typeclass induction.</p>
    
    <h2 id="destination-alpha-librae" class="section"><a class="anchor-link" href="#destination-alpha-librae"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Destination: Alpha Librae</h2>
    <p>The star that we&#39;re aiming for is Alpha Librae.  This is pretty far, so we can only send one very small person.  We have been given the following quantities to work with:</p>
    <ul>
      <li>rocket mass of a small person - <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>40</mn><mtext>kg</mtext></mrow><annotation encoding="application/x-tex"> 40 \text{kg} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">40</span><span class="mord text"><span class="mord">kg</span></span></span></span></span></li>
      <li>fuel mass of a lot of fuel - <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>10</mn><mn>4</mn></msup><mtext>kg</mtext></mrow><annotation encoding="application/x-tex"> 10^4 \text{kg} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mord text"><span class="mord">kg</span></span></span></span></span></li>
      <li>exhaust speed of a decent fuel - <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>10</mn><mn>6</mn></msup><msup><mtext>ms</mtext><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex"> 10^6 \text{ms}^{-1} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span><span class="mord"><span class="mord text"><span class="mord">ms</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></li>
      <li>distance to Alpha Librae - <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>77</mn><mtext>ly</mtext></mrow><annotation encoding="application/x-tex"> 77 \text{ly} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">77</span><span class="mord text"><span class="mord">ly</span></span></span></span></span></li>
    </ul>
    <p>We want to calculate when the rocket will arrive.</p>
    <p>To do so, we&#39;re going to make use of a formula known as the <em>Ideal Rocket Equation</em>.
    This calculates the speed of a rocket in ideal conditions.</p>
    <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">rocketSpeed</span><span> = </span><span class="identifier">exhaustSpeed</span><span> * </span><span class="identifier">log</span><span>((</span><span class="identifier">rocketMass</span><span> + </span><span class="identifier">fuelMass</span><span>) / </span><span class="identifier">rocketMass</span><span>)</span></code></pre>
    <p>Once we have the speed, we can work out the travel time.</p>
    <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">time</span><span> = </span><span class="identifier">distance</span><span> / </span><span class="identifier">rocketSpeed</span></code></pre>
    
    <h3 id="plugging-the-numbers-in" class="section"><a class="anchor-link" href="#plugging-the-numbers-in"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Plugging the numbers in</h3>
    <p>Let&#39;s do what we&#39;re used to doing and use doubles:</p>
    <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">rocketSpeed</span><span> = </span><span class="number-literal">1000000.0</span><span> * </span><span class="identifier">log</span><span>((</span><span class="number-literal">40.0</span><span> + </span><span class="number-literal">10000.0</span><span>) / </span><span class="number-literal">40.0</span><span>)
</span><span class="comment">// rocketSpeed: Double = 5525452.939131783
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">time</span><span> = </span><span class="number-literal">77.0</span><span> / </span><span class="identifier">rocketSpeed</span><span>
</span><span class="comment">// time: Double = 1.39355091515989E-5</span></code></pre>
    <p>Fantastic! We can get to Libra in less than a day!</p>
    <p>Unfortunately, this time estimate is too far off to be valid.  We can&#39;t get to Libra that quickly at light speed, let alone rocket speed.  We&#39;ve clearly made a mistake somewhere.  Instead of pouring over our code to find out where that is, let&#39;s try and use the compiler.</p>
    
    <h3 id="using-types" class="section"><a class="anchor-link" href="#using-types"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Using types</h3>
    <p>We can add some type safety to this problem by using a case class to represent each quantity.</p>
    <pre><code class="nohighlight"><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">value</span><span>: </span><span class="type-name">Double</span><span>)</span></code></pre>
    <p><code>A</code> represents the quantity dimension. So given the following dimensions:</p>
    <pre><code class="nohighlight"><span class="keyword">type</span><span> </span><span class="type-name">Kilogram</span><span>
</span><span class="keyword">type</span><span> </span><span class="type-name">Metre</span><span>
</span><span class="keyword">type</span><span> </span><span class="type-name">Second</span><span>
</span><span class="keyword">type</span><span> </span><span class="type-name">MetresPerSecond</span><span>
</span><span class="keyword">type</span><span> </span><span class="type-name">C</span><span>
</span><span class="keyword">type</span><span> </span><span class="type-name">LightYear</span><span>
</span><span class="keyword">type</span><span> </span><span class="type-name">Year</span></code></pre>
    <p>We can create quantities:</p>
    <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">rocketMass</span><span> = </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">Kilogram</span><span>](</span><span class="number-literal">40.0</span><span>)
</span><span class="keyword">val</span><span> </span><span class="identifier">fuelMass</span><span> = </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">Kilogram</span><span>](</span><span class="number-literal">10000.0</span><span>)
</span><span class="keyword">val</span><span> </span><span class="identifier">exhaust</span><span> = </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">MetresPerSecond</span><span>](</span><span class="number-literal">1000000.0</span><span>)
</span><span class="keyword">val</span><span> </span><span class="identifier">distance</span><span> = </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">LightYear</span><span>](</span><span class="number-literal">77.0</span><span>)</span></code></pre>
    <p>It&#39;s important to note that these are <em>types</em>, not classes.  We never instantiate a <code>MetresPerSecond</code> - we&#39;re just using it to differentiate between <code>Quantity[MetresPerSecond]</code> and <code>Quantity[Year]</code> at the type level.</p>
    <p>So how does this change the code?</p>
    <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">rocketSpeed</span><span> = </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">MetresPerSecond</span><span>](</span><span class="identifier">exhaust</span><span>.</span><span class="identifier">value</span><span> * </span><span class="identifier">log</span><span>((</span><span class="identifier">rocketMass</span><span>.</span><span class="identifier">value</span><span> + </span><span class="identifier">fuelMass</span><span>.</span><span class="identifier">value</span><span>) / </span><span class="identifier">rocketMass</span><span>.</span><span class="identifier">value</span><span>))
</span><span class="comment">// rocketSpeed: Quantity[Types.MetresPerSecond] = Quantity(5525452.939131783)
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">time</span><span> = </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">Year</span><span>](</span><span class="identifier">distance</span><span>.</span><span class="identifier">value</span><span> / </span><span class="identifier">rocketSpeed</span><span>.</span><span class="identifier">value</span><span>)
</span><span class="comment">// time: Quantity[Types.Year] = Quantity(1.39355091515989E-5)</span></code></pre>
    <p>In short, it doesn&#39;t. The code might be clearer, but we don&#39;t know what the bug is.  This is because the compiler isn&#39;t doing anything with the types we&#39;ve added.</p>
    
    <h3 id="operating-on-quantities" class="section"><a class="anchor-link" href="#operating-on-quantities"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Operating on quantities</h3>
    <p>We can encode our first law of addition at compile time by creating a function to add quantities:</p>
    <pre><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">add</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">q0</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">A</span><span>], </span><span class="identifier">q1</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">A</span><span>]): </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="type-name">Quantity</span><span>(</span><span class="identifier">q0</span><span>.</span><span class="identifier">value</span><span> + </span><span class="identifier">q1</span><span>.</span><span class="identifier">value</span><span>)</span></code></pre>
    <p>This ensures that quantities can only be added to other quantities of the same type.  Trying to add quantities of different types will result in a compilation error.</p>
    <p>A quantity can also be multiplied by a dimensionless scalar value to give a quantity of the same dimension.</p>
    <pre><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">times</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">q</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">A</span><span>], </span><span class="identifier">v</span><span>: </span><span class="type-name">Double</span><span>): </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="type-name">Quantity</span><span>(</span><span class="identifier">q</span><span>.</span><span class="identifier">value</span><span> * </span><span class="identifier">v</span><span>)</span></code></pre>
    <p>It would be great if we could divide quantities too.  Writing a divide function is more difficult:</p>
    <pre><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">divide</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>, </span><span class="type-name">Magic</span><span>](</span><span class="identifier">q0</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">A</span><span>], </span><span class="identifier">q1</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">B</span><span>]): </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">Magic</span><span>] =
  </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">Magic</span><span>](</span><span class="identifier">q0</span><span>.</span><span class="identifier">value</span><span> / </span><span class="identifier">q1</span><span>.</span><span class="identifier">value</span><span>)</span></code></pre>
    <p>There&#39;s a clear problem with trying to do this.  When we divide a quantity by another, we don&#39;t know what the <code>Magic</code> output type should be.
    The output type is dependent on what the input types are (for example, dividing <code>Metre</code> by <code>Second</code> should give <code>MetresPerSecond</code>).  The compiler needs a way of working out what the output is, provided that it knows the input types.</p>
    
    <h3 id="dependent-types" class="section"><a class="anchor-link" href="#dependent-types"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Dependent types</h3>
    <p>What we actually want is a dependent type.  A division operation should occur at the type level, taking two input types and supplying a dependent output type.
    We can create the trait <code>Divide</code> with a dependent output type:</p>
    <pre><code class="nohighlight"><span class="keyword">trait</span><span> </span><span class="type-name">Divide</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>] {
  </span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span>
}</span></code></pre>
    <p>We also need to define an <code>Aux</code> type alias.  This is known as the Aux pattern and makes it easier to refer to all three types at once.</p>
    <pre><code class="nohighlight"><span class="keyword">object</span><span> </span><span class="type-name">Divide</span><span> {
  </span><span class="keyword">type</span><span> </span><span class="type-name">Aux</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>, </span><span class="type-name">Out0</span><span>] = </span><span class="type-name">Divide</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>] { </span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span> = </span><span class="type-name">Out0</span><span> }
}</span></code></pre>
    <p>We can create instances of this divide typeclass with different output types, so the output type is dependent on the value of the divide typeclass instance.</p>
    <p>When dividing, the compiler looks for this implicit typeclass instance and returns a quantity corresponding to the output type.</p>
    <pre><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">divide</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">q0</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">A</span><span>], </span><span class="identifier">q1</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">B</span><span>])(</span><span class="keyword">implicit</span><span> </span><span class="identifier">d</span><span>: </span><span class="type-name">Divide</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>]): </span><span class="type-name">Quantity</span><span>[</span><span class="identifier">d</span><span>.</span><span class="type-name">Out</span><span>] =
  </span><span class="type-name">Quantity</span><span>[</span><span class="identifier">d</span><span>.</span><span class="type-name">Out</span><span>](</span><span class="identifier">q0</span><span>.</span><span class="identifier">value</span><span> / </span><span class="identifier">q1</span><span>.</span><span class="identifier">value</span><span>)</span></code></pre>
    <p>So given that we want to divide <code>A</code> by <code>B</code>, the compiler will look for a value of <code>Divide[A, B]</code> and find the <code>Out</code> type of it.  If no instance exists, the code doesn&#39;t compile.</p>
    <p>We&#39;ll need some more types to represent the result of a division:</p>
    <pre><code class="nohighlight"><span class="keyword">type</span><span> </span><span class="type-name">LightYearSecondsPerMetre</span><span>
</span><span class="keyword">type</span><span> </span><span class="type-name">MetresPerSecondPerC</span><span>
</span><span class="keyword">type</span><span> </span><span class="type-name">Dimensionless</span></code></pre>
    <p>And we&#39;ll need to write instances for all combinations of dimensions.</p>
    <pre><code class="nohighlight"><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">kgDivideKg</span><span>: </span><span class="type-name">Divide</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">Kilogram</span><span>, </span><span class="type-name">Kilogram</span><span>, </span><span class="type-name">Dimensionless</span><span>] =
  </span><span class="keyword">new</span><span> </span><span class="type-name">Divide</span><span>[</span><span class="type-name">Kilogram</span><span>, </span><span class="type-name">Kilogram</span><span>] { </span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span> = </span><span class="type-name">Dimensionless</span><span> }

</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">lyDivideC</span><span>: </span><span class="type-name">Divide</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">LightYear</span><span>, </span><span class="type-name">C</span><span>, </span><span class="type-name">Year</span><span>] =
  </span><span class="keyword">new</span><span> </span><span class="type-name">Divide</span><span>[</span><span class="type-name">LightYear</span><span>, </span><span class="type-name">C</span><span>] { </span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span> = </span><span class="type-name">Year</span><span> }

</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">lyDivideMps</span><span>: </span><span class="type-name">Divide</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">LightYear</span><span>, </span><span class="type-name">MetresPerSecond</span><span>, </span><span class="type-name">LightYearSecondsPerMetre</span><span>] =
  </span><span class="keyword">new</span><span> </span><span class="type-name">Divide</span><span>[</span><span class="type-name">LightYear</span><span>, </span><span class="type-name">MetresPerSecond</span><span>] { </span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span> = </span><span class="type-name">LightYearSecondsPerMetre</span><span> }

</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">mpsDivideC</span><span>: </span><span class="type-name">Divide</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">MetresPerSecond</span><span>, </span><span class="type-name">C</span><span>, </span><span class="type-name">MetresPerSecondPerC</span><span>] =
  </span><span class="keyword">new</span><span> </span><span class="type-name">Divide</span><span>[</span><span class="type-name">MetresPerSecond</span><span>, </span><span class="type-name">C</span><span>] { </span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span> = </span><span class="type-name">MetresPerSecondPerC</span><span> }

</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">mpsDivideMpsPerC</span><span>: </span><span class="type-name">Divide</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">MetresPerSecond</span><span>, </span><span class="type-name">MetresPerSecondPerC</span><span>, </span><span class="type-name">C</span><span>] =
  </span><span class="keyword">new</span><span> </span><span class="type-name">Divide</span><span>[</span><span class="type-name">MetresPerSecond</span><span>, </span><span class="type-name">MetresPerSecondPerC</span><span>] { </span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span> = </span><span class="type-name">C</span><span> }</span></code></pre>
    <p>And so on.</p>
    <p>Unfortunately, there are an infinite number of combinations, so there are an infinite number of instances.
    Nevertheless, let&#39;s plough on with the ones we&#39;ve written.  We can modify our rocket equation to use <code>add</code>, <code>times</code> and <code>divide</code>:</p>
    <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">rocketSpeed</span><span> = </span><span class="identifier">times</span><span>(</span><span class="identifier">exhaust</span><span>, </span><span class="identifier">log</span><span>(</span><span class="identifier">divide</span><span>(</span><span class="identifier">add</span><span>(</span><span class="identifier">rocketMass</span><span>, </span><span class="identifier">fuelMass</span><span>), </span><span class="identifier">rocketMass</span><span>).</span><span class="identifier">value</span><span>))
</span><span class="comment">// rocketSpeed: Quantity[Types.MetresPerSecond] = Quantity(5525452.939131783)
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">time</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">Year</span><span>] = </span><span class="identifier">divide</span><span>(</span><span class="identifier">distance</span><span>, </span><span class="identifier">rocketSpeed</span><span>)
</span><span class="comment">// &lt;console&gt;:31: error: type mismatch;
//  found   : Quantity[lyDivideMps.Out]
//     (which expands to)  Quantity[MoreTypes.LightYearSecondsPerMetre]
//  required: Quantity[Types.Year]
//        val time: Quantity[Year] = divide(distance, rocketSpeed)
//                                         ^</span></code></pre>
    <p>Great!  We&#39;ve caught our bug!  The result was in <code>LightYearSecondsPerMetre</code>, not <code>Year</code>.  We made a unit conversion error, just like the Mars orbiter.</p>
    <p>We can now fix this by adding a conversion:</p>
    <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">metresPerSecondPerC</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">MetresPerSecondPerC</span><span>] = </span><span class="identifier">divide</span><span>(</span><span class="type-name">Quantity</span><span>[</span><span class="type-name">MetresPerSecond</span><span>](</span><span class="number-literal">300000000.0</span><span>), </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">C</span><span>](</span><span class="number-literal">1.0</span><span>))
</span><span class="comment">// metresPerSecondPerC: Quantity[MoreTypes.MetresPerSecondPerC] = Quantity(3.0E8)
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">speedInC</span><span> = </span><span class="identifier">divide</span><span>(</span><span class="identifier">rocketSpeed</span><span>, </span><span class="identifier">metresPerSecondPerC</span><span>)
</span><span class="comment">// speedInC: Quantity[mpsDivideMpsPerC.Out] = Quantity(0.018418176463772612)
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">time</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">Year</span><span>] = </span><span class="identifier">divide</span><span>(</span><span class="identifier">distance</span><span>, </span><span class="identifier">speedInC</span><span>)
</span><span class="comment">// time: Quantity[Types.Year] = Quantity(4180.65274547967)</span></code></pre>
    <p>It seems like it&#39;s going to take a lot longer than we hoped to get to Libra.  Perhaps it&#39;s unwise to send a person.</p>
    
    <h2 id="automatic-derivation" class="section"><a class="anchor-link" href="#automatic-derivation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Automatic derivation</h2>
    <p>We found the bug, but we needed to explicitly write out typeclass instances for every combination of dimensions.
    This might have worked for our small problem, but it just doesn&#39;t scale in the long run.
    We need to figure out a way of deriving the typeclass instances automatically.
    To attempt this, we first need to generalize what a combination of dimensions actually is.</p>
    
    <h3 id="representing-dimensions" class="section"><a class="anchor-link" href="#representing-dimensions"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Representing dimensions</h3>
    <p>We can represent a combination of dimensions as a heterogeneous list (HList) of base dimensions.  HLists are defined in <a href="https://github.com/milessabin/shapeless">shapeless</a>, a cornerstone of most functional libraries, and can be thought of as a type level list.</p>
    <pre><code class="nohighlight"><span class="keyword">type</span><span> </span><span class="type-name">LightYearSeconds</span><span> = </span><span class="type-name">LightYear</span><span> :: </span><span class="type-name">Second</span><span> :: </span><span class="type-name">HNil</span></code></pre>
    <p>This is good for multiples of dimensions, such as <code>LightYearSeconds</code>, but doesn&#39;t represent combinations created from division, such as <code>MetresPerSecond</code>.
    To do this, we need some way of representing integer exponents as types. We can represent integers as types using Singleton types.  We actually need these singleton types in type position.  This is supported by a new feature present in <a href="https://typelevel.org/scala/">Typelevel Scala</a>, called <a href="http://docs.scala-lang.org/sips/pending/42.type.html">literal types</a>:</p>
    <pre><code class="nohighlight"><span class="identifier">scalaOrganization</span><span> := </span><span class="string-literal">&quot;org.typelevel&quot;</span><span>
</span><span class="identifier">scalacOptions</span><span> += </span><span class="string-literal">&quot;-Yliteral-types&quot;</span></code></pre>
    <p>We need to represent a key value pair of dimension and integer exponent. We could use a <code>Tuple</code> for this, but will use a shapeless <code>FieldType</code> instead.  This is similar to a <code>Tuple</code>, but is more compatible with some of shapeless&#39;s typeclasses.</p>
    <pre><code class="nohighlight"><span class="keyword">type</span><span> </span><span class="type-name">MetresPerSecond</span><span> = </span><span class="type-name">FieldType</span><span>[</span><span class="type-name">Metre</span><span>, </span><span class="number-literal">1</span><span>] :: </span><span class="type-name">FieldType</span><span>[</span><span class="type-name">Second</span><span>, -</span><span class="number-literal">1</span><span>] :: </span><span class="type-name">HNil</span></code></pre>
    <p>It&#39;s important to note that the number <code>1</code> above is a type, not a value.  Because it&#39;s a type, the compiler can work with it.</p>
    
    <h3 id="operations-on-singleton-types" class="section"><a class="anchor-link" href="#operations-on-singleton-types"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Operations on Singleton types</h3>
    <p>When we multiply and divide dimensions, we want to add or subtract from these exponents.</p>
    <p>We can use a library called <a href="https://github.com/fthomas/singleton-ops">singleton ops</a> to do this.  This provides us with type level integer operations using the <code>OpInt</code> typeclass:</p>
    <pre><code class="nohighlight"><span class="type-name">OpInt</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="number-literal">1</span><span> + </span><span class="number-literal">2</span><span>, </span><span class="number-literal">3</span><span>]
</span><span class="type-name">OpInt</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="number-literal">3</span><span> * </span><span class="number-literal">2</span><span>, </span><span class="number-literal">6</span><span>]</span></code></pre>
    <p>It also provides a convenient alias for integer singleton types</p>
    <pre><code class="nohighlight"><span class="keyword">type</span><span> </span><span class="type-name">XInt</span><span> = </span><span class="type-name">Singleton</span><span> </span><span class="keyword">with</span><span> </span><span class="type-name">Int</span></code></pre>
    <p>The type <code>1</code>, for example, is a subtype of <code>XInt</code>.</p>
    
    <h3 id="deriving-typeclass-instances" class="section"><a class="anchor-link" href="#deriving-typeclass-instances"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Deriving typeclass instances</h3>
    <p>We now need to automatically derive typeclass instances of <code>Divide</code>.
    To do this, we&#39;re going to derive instances for <code>Invert</code> and <code>Multiply</code> operations first.
    Deriving <code>Divide</code> then becomes much simpler.</p>
    <p>The technique we&#39;re going to use to automatically derive instances is known as typeclass induction.</p>
    
    <h3 id="typeclass-induction" class="section"><a class="anchor-link" href="#typeclass-induction"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Typeclass Induction</h3>
    <p>Aaron Levin gave a great introduction to induction in his talk earlier at the <a href="https://typelevel.org/event/2017-06-summit-copenhagen/">Typelevel Summit</a>.  In summary, you can derive an implicit typeclass instance for all cases by:</p>
    <ol class="arabic">
      <li>Providing it for the base case</li>
      <li>Providing it for the n + 1 case, given that the n case is provided</li>
    </ol>
    <p>This is similar to the mathematical method of proof by induction.</p>
    
    <h3 id="invert" class="section"><a class="anchor-link" href="#invert"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Invert</h3>
    <p>We&#39;re first going to derive inductive typeclass instances for the <code>Invert</code> operation.
    Inverting a quantity raises it to the exponent of <code>-1</code>.  This means that the exponents of all dimensions must be negated.</p>
    <p>For example, the inverse of <code>FieldType[Metre, 1] :: HNil</code> is <code>FieldType[Metre, -1] :: HNil</code>.
    <code>Invert</code> takes one input type and returns one output type:</p>
    <pre><code class="nohighlight"><span class="keyword">trait</span><span> </span><span class="type-name">Invert</span><span>[</span><span class="type-name">A</span><span>] {
	</span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span>
}
</span><span class="keyword">object</span><span> </span><span class="type-name">Invert</span><span> {
	</span><span class="keyword">type</span><span> </span><span class="type-name">Aux</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">Out0</span><span>] = </span><span class="type-name">Invert</span><span>[</span><span class="type-name">A</span><span>] { </span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span> = </span><span class="type-name">Out0</span><span> }
}</span></code></pre>
    <p>To inductively derive typeclass instances for inverting, we need to prove that:</p>
    <ol class="arabic">
      <li>We can derive an instance for <code>HNil</code> (the base case)</li>
      <li>We can derive an instance for a non-empty HList (the n + 1 case), provided there is an existing instance for its tail (the n case)</li>
    </ol>
    <p>The base case operates on <code>HNil</code></p>
    <pre><code class="nohighlight"><span class="keyword">implicit</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">baseCase</span><span>: </span><span class="type-name">Invert</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">HNil</span><span>, </span><span class="type-name">HNil</span><span>] = </span><span class="keyword">new</span><span> </span><span class="type-name">Invert</span><span>[</span><span class="type-name">HNil</span><span>] { </span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span> = </span><span class="type-name">HNil</span><span> }</span></code></pre>
    <p>The inductive case assumes that the tail has an instance, and derives an instance for the head by negating the exponent:</p>
    <pre><code class="nohighlight"><span class="keyword">implicit</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">inductiveCase</span><span>[</span><span class="type-name">D</span><span>, </span><span class="type-name">Exp</span><span> &lt;: </span><span class="type-name">XInt</span><span>, </span><span class="type-name">NExp</span><span> &lt;: </span><span class="type-name">XInt</span><span>, </span><span class="type-name">Tail</span><span> &lt;: </span><span class="type-name">HList</span><span>,
  </span><span class="type-name">OutTail</span><span> &lt;: </span><span class="type-name">HList</span><span>](
    </span><span class="keyword">implicit</span><span> </span><span class="identifier">negateEv</span><span>: </span><span class="type-name">OpInt</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">Negate</span><span>[</span><span class="type-name">Exp</span><span>], </span><span class="type-name">NExp</span><span>],
    </span><span class="identifier">tailEv</span><span>: </span><span class="type-name">Invert</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">Tail</span><span>, </span><span class="type-name">OutTail</span><span>]
): </span><span class="type-name">Invert</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">D</span><span>, </span><span class="type-name">Exp</span><span>] :: </span><span class="type-name">Tail</span><span>, </span><span class="type-name">FieldType</span><span>[</span><span class="type-name">D</span><span>, </span><span class="type-name">NExp</span><span>] :: </span><span class="type-name">OutTail</span><span>] =
  </span><span class="keyword">new</span><span> </span><span class="type-name">Invert</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">D</span><span>, </span><span class="type-name">Exp</span><span>] :: </span><span class="type-name">Tail</span><span>] {
    </span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span> = </span><span class="type-name">FieldType</span><span>[</span><span class="type-name">D</span><span>, </span><span class="type-name">NExp</span><span>] :: </span><span class="type-name">OutTail</span><span>
}</span></code></pre>
    <p>When the compiler looks for the implicit instance for <code>FieldType[Metre, 1] :: HNil</code>:</p>
    <ul>
      <li>It finds that the <code>inductiveCase</code> method has a return type which fits the signature</li>
      <li>It can find the required evidence <code>negateEv</code> for negating <code>1</code> from singleton ops</li>
      <li>It requires evidence of an implicit instance for the tail <code>HNil</code></li>
      <li>It finds that <code>baseCase</code> provides this evidence</li>
    </ul>
    <p>So in hunting for implicit typeclass instance for the whole list, the compiler goes and finds instances for the tail (the n case), right up until the base.  If we provide an inductive proof with a <code>baseCase</code> and an <code>inductiveCase</code>, we fit the bill for what the compiler needs.</p>
    
    <h3 id="multiply" class="section"><a class="anchor-link" href="#multiply"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Multiply</h3>
    <p>Now that we&#39;ve tested a basic example of induction, we can go on to a more complex one.</p>
    <p>We want to multiply two HLists of dimensions together. This means that the exponents should be added.</p>
    <pre><code class="nohighlight"><span class="keyword">trait</span><span> </span><span class="type-name">Multiply</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>] {
  </span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span>
}
</span><span class="keyword">object</span><span> </span><span class="type-name">Multiply</span><span> {
  </span><span class="keyword">type</span><span> </span><span class="type-name">Aux</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>, </span><span class="type-name">Out0</span><span>] = </span><span class="type-name">Multiply</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>] { </span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span> = </span><span class="type-name">Out0</span><span> }
}</span></code></pre>
    <p>This is harder to make inductive because there are two input lists involved.  Luckily, we only need to recurse over one of them, as we can pick dimensions from the other using shapeless&#39;s <code>Selector</code>.  We will recurse over the left list and can pick elements from the right list.</p>
    <p>Our base case can be the same:</p>
    <pre><code class="nohighlight"><span class="keyword">implicit</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">baseCase</span><span>: </span><span class="type-name">Multiply</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">HNil</span><span>, </span><span class="type-name">HNil</span><span>, </span><span class="type-name">HNil</span><span>] = </span><span class="keyword">new</span><span> </span><span class="type-name">Multiply</span><span>[</span><span class="type-name">HNil</span><span>, </span><span class="type-name">HNil</span><span>] {
  </span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span> = </span><span class="type-name">HNil</span><span>
}</span></code></pre>
    <p>We can define the inductive case using the following logic:
    1.  Pick the exponent in the right list corresponding to the head dimension in the left list
    2.  Add the left and right exponents together
    3.  Filter the term from the right list to get the remaining elements
    4.  Look for a typeclass instance for the left list tail and the remaining elements in the right list</p>
    <pre><code class="nohighlight"><span class="keyword">implicit</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">inductiveCase</span><span>[</span><span class="type-name">D</span><span>, </span><span class="type-name">R</span><span> &lt;: </span><span class="type-name">HList</span><span>, </span><span class="type-name">LExp</span><span> &lt;: </span><span class="type-name">XInt</span><span> , </span><span class="type-name">RExp</span><span> &lt;: </span><span class="type-name">XInt</span><span>,
  </span><span class="type-name">OutExp</span><span> &lt;: </span><span class="type-name">XInt</span><span>, </span><span class="type-name">RTail</span><span> &lt;: </span><span class="type-name">HList</span><span>, </span><span class="type-name">LTail</span><span> &lt;: </span><span class="type-name">HList</span><span>, </span><span class="type-name">OutTail</span><span> &lt;: </span><span class="type-name">HList</span><span>](
  </span><span class="keyword">implicit</span><span> </span><span class="identifier">pickEv</span><span>: </span><span class="type-name">Selector</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">R</span><span>, </span><span class="type-name">D</span><span>, </span><span class="type-name">RExp</span><span>],
  </span><span class="identifier">addEv</span><span>: </span><span class="type-name">OpInt</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">LExp</span><span> + </span><span class="type-name">RExp</span><span>, </span><span class="type-name">OutExp</span><span>],
  </span><span class="identifier">filterEv</span><span>: </span><span class="type-name">FilterNot</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">R</span><span>, </span><span class="type-name">FieldType</span><span>[</span><span class="type-name">D</span><span>, </span><span class="type-name">RExp</span><span>], </span><span class="type-name">RTail</span><span>],
  </span><span class="identifier">tailEv</span><span>: </span><span class="type-name">Multiply</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">LTail</span><span>, </span><span class="type-name">RTail</span><span>, </span><span class="type-name">OutTail</span><span>]
): </span><span class="type-name">Multiply</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">D</span><span>, </span><span class="type-name">LExp</span><span>] :: </span><span class="type-name">LTail</span><span>, </span><span class="type-name">R</span><span>, </span><span class="type-name">FieldType</span><span>[</span><span class="type-name">D</span><span>, </span><span class="type-name">OutExp</span><span>] :: </span><span class="type-name">OutTail</span><span>] =
  </span><span class="keyword">new</span><span> </span><span class="type-name">Multiply</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">D</span><span>, </span><span class="type-name">LExp</span><span>] :: </span><span class="type-name">LTail</span><span>, </span><span class="type-name">R</span><span>] {
    </span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span> = </span><span class="type-name">FieldType</span><span>[</span><span class="type-name">D</span><span>, </span><span class="type-name">OutExp</span><span>] :: </span><span class="type-name">OutTail</span><span>
}</span></code></pre>
    <p>When the compiler looks for an implicit instance of multiply for <code>FieldType[Metre, -1] :: HNil</code> and <code>FieldType[Metre, 3] :: HNil</code>:</p>
    <ul>
      <li>It finds that the <code>inductiveCase</code> has a return type which fits the signature</li>
      <li>Given that the head of the left list is <code>Metre</code>, it selects the exponent for <code>Metre</code> from the right list</li>
      <li>It can find the evidence <code>addEv</code> to add the exponents <code>-1</code> and <code>3</code></li>
      <li>It filters <code>Metre</code> from the right list to get <code>HNil</code></li>
      <li>It requires evidence of an instance for  <code>HNil</code> and <code>HNil</code></li>
      <li>This is provided by the base case</li>
    </ul>
    <p>The compiler can now find instances of <code>Multiply</code>, as long as a dimension appears in both the left and right lists.
    This can be extended to when a dimension doesn&#39;t appear by writing a few more inductive cases.</p>
    
    <h3 id="divide" class="section"><a class="anchor-link" href="#divide"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Divide</h3>
    <p>The reason we went to the effort of writing <code>Invert</code> and <code>Multiply</code> was to divide.
    Dividing a numerator by a denominator is as simple as inverting the denominator and multiplying it by the numerator.
    We can write this in a single non-inductive instance:</p>
    <pre><code class="nohighlight"><span class="keyword">implicit</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">divide</span><span>[</span><span class="type-name">L</span><span> &lt;: </span><span class="type-name">HList</span><span>, </span><span class="type-name">R</span><span> &lt;: </span><span class="type-name">HList</span><span>, </span><span class="type-name">RInverted</span><span> &lt;: </span><span class="type-name">HList</span><span>,
  </span><span class="type-name">Divided</span><span> &lt;: </span><span class="type-name">HList</span><span>](
  </span><span class="keyword">implicit</span><span> </span><span class="identifier">invertEv</span><span>: </span><span class="type-name">Invert</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">R</span><span>, </span><span class="type-name">RInverted</span><span>],
  </span><span class="identifier">multiplyEv</span><span>: </span><span class="type-name">Multiply</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">L</span><span>, </span><span class="type-name">RInverted</span><span>, </span><span class="type-name">Divided</span><span>]
): </span><span class="type-name">Divide</span><span>.</span><span class="type-name">Aux</span><span>[</span><span class="type-name">L</span><span>, </span><span class="type-name">R</span><span>, </span><span class="type-name">Divided</span><span>] = </span><span class="keyword">new</span><span> </span><span class="type-name">Divide</span><span>[</span><span class="type-name">L</span><span>, </span><span class="type-name">R</span><span>] {
  </span><span class="keyword">type</span><span> </span><span class="type-name">Out</span><span> = </span><span class="type-name">Divided</span><span>
}</span></code></pre>
    <p>That&#39;s far simpler than the work we&#39;ve done before - we&#39;re just building on the typeclasses we wrote to do this.</p>
    
    <h3 id="automatically-derived-instances" class="section"><a class="anchor-link" href="#automatically-derived-instances"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Automatically derived instances</h3>
    <p>We can now have compile time dimensional analysis without writing out divide instances for every combination of dimensions:</p>
    <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">rocketMass</span><span> = </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">Kilogram</span><span>, </span><span class="number-literal">1</span><span>] :: </span><span class="type-name">HNil</span><span>](</span><span class="number-literal">40.0</span><span>)
</span><span class="keyword">val</span><span> </span><span class="identifier">fuelMass</span><span> = </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">Kilogram</span><span>, </span><span class="number-literal">1</span><span>] :: </span><span class="type-name">HNil</span><span>](</span><span class="number-literal">10000.0</span><span>)
</span><span class="keyword">val</span><span> </span><span class="identifier">exhaust</span><span> = </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">Metre</span><span>, </span><span class="number-literal">1</span><span>] :: </span><span class="type-name">FieldType</span><span>[</span><span class="type-name">Second</span><span>, -</span><span class="number-literal">1</span><span>] :: </span><span class="type-name">HNil</span><span>](</span><span class="number-literal">1000000.0</span><span>)
</span><span class="keyword">val</span><span> </span><span class="identifier">distance</span><span> = </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">LightYear</span><span>, </span><span class="number-literal">1</span><span>] :: </span><span class="type-name">HNil</span><span>](</span><span class="number-literal">77.0</span><span>)

</span><span class="keyword">val</span><span> </span><span class="identifier">rocketSpeed</span><span> = </span><span class="identifier">times</span><span>(</span><span class="identifier">exhaust</span><span>, </span><span class="identifier">log</span><span>(</span><span class="identifier">divide</span><span>(</span><span class="identifier">add</span><span>(</span><span class="identifier">rocketMass</span><span>, </span><span class="identifier">fuelMass</span><span>), </span><span class="identifier">rocketMass</span><span>).</span><span class="identifier">value</span><span>))
</span><span class="keyword">val</span><span> </span><span class="identifier">time</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">Year</span><span>, </span><span class="number-literal">1</span><span>] :: </span><span class="type-name">HNil</span><span>] = </span><span class="identifier">divide</span><span>(</span><span class="identifier">distance</span><span>, </span><span class="identifier">rocketSpeed</span><span>)
</span><span class="comment">// error: type mismatch; found: FieldType[LightYear, 1] :: FieldType[Metre, -1] :: FieldType[Second, 1] :: HNil; required: FieldType[Year, 1] :: HNil</span></code></pre>
    <p>Yay! We&#39;ve solved the problem!  It looks a lot more verbose than what we started with, but we can tidy this up by using extension methods:</p>
    <pre><code class="nohighlight"><span class="keyword">implicit</span><span> </span><span class="keyword">final</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">DoubleOps</span><span>(</span><span class="keyword">val</span><span> </span><span class="identifier">d</span><span>: </span><span class="type-name">Double</span><span>) {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">ly</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">LightYear</span><span>,</span><span class="number-literal">1</span><span>] :: </span><span class="type-name">HNil</span><span>] = </span><span class="type-name">Quantity</span><span>(</span><span class="identifier">d</span><span>)
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">kg</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">Kilogram</span><span>, </span><span class="number-literal">1</span><span>] :: </span><span class="type-name">HNil</span><span>] = </span><span class="type-name">Quantity</span><span>(</span><span class="identifier">d</span><span>)
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">yr</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">Year</span><span>, </span><span class="number-literal">1</span><span>] :: </span><span class="type-name">HNil</span><span>]     = </span><span class="type-name">Quantity</span><span>(</span><span class="identifier">d</span><span>)
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">mps</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">Metre</span><span>, </span><span class="number-literal">1</span><span>] :: </span><span class="type-name">FieldType</span><span>[</span><span class="type-name">Second</span><span>, -</span><span class="number-literal">1</span><span>] :: </span><span class="type-name">HNil</span><span>] = </span><span class="type-name">Quantity</span><span>(</span><span class="identifier">d</span><span>)
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">c</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">LightYear</span><span>, </span><span class="number-literal">1</span><span>] :: </span><span class="type-name">FieldType</span><span>[</span><span class="type-name">Year</span><span>, -</span><span class="number-literal">1</span><span>] :: </span><span class="type-name">HNil</span><span>] = </span><span class="type-name">Quantity</span><span>(</span><span class="identifier">d</span><span>)
}</span></code></pre>
    <p>We can also add symbolic infix operators for <code>add</code>, <code>times</code> and <code>divide</code>:</p>
    <pre><code class="nohighlight"><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">value</span><span>: </span><span class="type-name">Double</span><span>) {
  </span><span class="keyword">def</span><span> +(</span><span class="identifier">q</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">A</span><span>]): </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="type-name">Quantity</span><span>(</span><span class="identifier">value</span><span> + </span><span class="identifier">q</span><span>.</span><span class="identifier">value</span><span>)
  </span><span class="keyword">def</span><span> *(</span><span class="identifier">v</span><span>: </span><span class="type-name">Double</span><span>): </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="type-name">Quantity</span><span>(</span><span class="identifier">value</span><span> + </span><span class="identifier">v</span><span>)
  </span><span class="keyword">def</span><span> /[</span><span class="type-name">B</span><span>](</span><span class="identifier">q</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">B</span><span>])(</span><span class="keyword">implicit</span><span> </span><span class="identifier">d</span><span>: </span><span class="type-name">Divide</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>]): </span><span class="type-name">Quantity</span><span>[</span><span class="identifier">d</span><span>.</span><span class="type-name">Out</span><span>] = </span><span class="type-name">Quantity</span><span>(</span><span class="identifier">value</span><span> / </span><span class="identifier">q</span><span>.</span><span class="identifier">value</span><span>)
}</span></code></pre>
    
    <h2 id="we-ve-reached-libra" class="section"><a class="anchor-link" href="#we-ve-reached-libra"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>We&#39;ve reached Libra!</h2>
    <p>We started with doubles:</p>
    <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">rocketSpeed</span><span> = </span><span class="number-literal">1000000.0</span><span> * </span><span class="identifier">log</span><span>((</span><span class="number-literal">40.0</span><span> + </span><span class="number-literal">10000.0</span><span>) / </span><span class="number-literal">40.0</span><span>)
</span><span class="keyword">val</span><span> </span><span class="identifier">time</span><span> = </span><span class="number-literal">77.0</span><span> / </span><span class="identifier">rocketSpeed</span></code></pre>
    <p>And we finished with compile time dimensional analysis:</p>
    <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">rocketSpeed</span><span> = </span><span class="number-literal">1000000.0</span><span>.</span><span class="identifier">mps</span><span> * </span><span class="identifier">log</span><span>(((</span><span class="number-literal">40.0</span><span>.</span><span class="identifier">kg</span><span> +</span><span class="number-literal">10000.0</span><span>.</span><span class="identifier">kg</span><span>) /</span><span class="number-literal">40.0</span><span>.</span><span class="identifier">kg</span><span>).</span><span class="identifier">value</span><span>)
</span><span class="keyword">val</span><span> </span><span class="identifier">speedConversion</span><span> = </span><span class="number-literal">300000000.0</span><span>.</span><span class="identifier">mps</span><span> / </span><span class="number-literal">1</span><span>.</span><span class="identifier">c</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">speedInC</span><span> = </span><span class="identifier">rocketSpeed</span><span> / </span><span class="identifier">speedConversion</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">time</span><span> = </span><span class="number-literal">77.0</span><span>.</span><span class="identifier">ly</span><span> / </span><span class="identifier">speedInC</span><span>
</span><span class="comment">//time: Quantity[FieldType[Year, 1] :: HNil] = Quantity(4180.65274634)</span></code></pre>
    <p>The code isn&#39;t more verbose - if anything, it&#39;s more explanatory and just as easy to work with.</p>
    
    <h2 id="rolling-this-out-to-more-problems" class="section"><a class="anchor-link" href="#rolling-this-out-to-more-problems"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Rolling this out to more problems</h2>
    <p>All we need to provide for the business logic of our rocket launch problem are the dimensions and <code>DoubleOps</code>.
    We could roll this out to any other problem.  Let&#39;s say we wanted to do a currency conversion between <code>GBP</code> and <code>DKK</code>:</p>
    <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">exchangeRate</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">DKK</span><span>, </span><span class="number-literal">1</span><span>] :: </span><span class="type-name">FieldType</span><span>[</span><span class="type-name">GBP</span><span>, -</span><span class="number-literal">1</span><span>] :: </span><span class="type-name">HNil</span><span>] =
   </span><span class="identifier">currentExchangeRate</span><span>()
</span><span class="type-name">Val</span><span> </span><span class="identifier">krone</span><span>: </span><span class="type-name">Quantity</span><span>[</span><span class="type-name">FieldType</span><span>[</span><span class="type-name">DKK</span><span>, </span><span class="number-literal">1</span><span>] :: </span><span class="type-name">HNil</span><span>] = </span><span class="number-literal">10</span><span>.</span><span class="identifier">gbp</span><span> * </span><span class="identifier">exchangeRate</span></code></pre>
    <p>We get dimensional analysis for any problem domain out of the box!</p>
    <p>Most of the code we&#39;ve written is library code.  In fact, it&#39;s Libra code!  <a href="https://to-ithaca.github.io/libra/">Libra</a> is a dimensional analysis library based on typelevel induction.  It performs compile time dimensional analysis to any problem domain.  It also uses <a href="https://github.com/non/spire">spire</a> for its numeric typeclasses, so can be used for far more than just doubles.</p>
    
    <h2 id="conclusion" class="section"><a class="anchor-link" href="#conclusion"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2 86.4 0 156.5 70 156.5 156.5 0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1c-29.3 29.3-69.1 45.8-110.6 45.8-86.4 0-156.5-70-156.5-156.5 0-1.5 0-3 .1-4.5 .5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9c0 .9 0 1.8 0 2.6 0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zM275.2 173.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1L91.1 258.2c-17.3 17.3-27.1 40.9-27.1 65.4 0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2-86.4 0-156.5-70-156.5-156.5 0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9 0 1.3 0 2.6 0 3.9-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8c0-.8 0-1.5 0-2.3 0-33.7-18-63.3-44.8-79.6z"/></svg></a>Conclusion</h2>
    <p>It&#39;s been a long way from the humble <code>Double</code>.  We started with basic types, explored dependent types, took a look at Typelevel Scala along the way, before finally ending up performing typelevel induction.  As a result, we&#39;ve managed to achieve compile time dimensional analysis for any problem. If you&#39;re curious about typelevel induction take a look at <a href="https://github.com/to-ithaca/libra">the Libra codebase</a> for more examples.  Enjoy!</p>
  </div>
</div>
<div class="bulma-section bulma-container bulma-is-max-desktop">
  <div class="bulma-columns">
    
    <div class="bulma-column">
      <article class="bulma-media">
  
  <div class="bulma-media-content">
    <div class="bulma-content">
      <p>
        <strong>Zainab Ali</strong> 
        
        
        <br />
        Zainab is a functional programmer who converted from object oriented design.  A physicist at heart, she was excited to find an application of dimensional analysis and dependent types to real world problems.  She is the author of Libra and a contributor to many typelevel libraries, such as cats and fs2.
        
        
        
      </p>
    </div>
    <nav class="bulma-level bulma-is-align-items-start">
      <div class="bulma-level-left bulma-is-flex-direction-row">
        
        
        
        
        
        
      </div>
    </nav>
  </div>
</article>

    </div>
    
  </div>
</div>


  </main>
  <footer class="bulma-footer">
  <div class="bulma-columns">
    <div class="bulma-column bulma-is-half">
      Copyright 2026 Typelevel Foundation and <a href="https://github.com/typelevel/typelevel.github.com/graphs/contributors">contributors</a>.
      Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> unless <a href="../colophon.html#license">noted otherwise</a>.
    </div>
    <div class="bulma-column">
      <ul>
        <li><a href="../projects/">Project Index</a></li>
        <li><a href="../community/meetups.html">Meetup Calendar</a></li>
        <li><a href="../foundation/people.html">Leadership</a></li>
      </ul>
    </div>
    <div class="bulma-column">
      <ul>
        <li><a href="../code-of-conduct/">Code of Conduct</a></li>
        <li><a href="../security.html">Security Policy</a></li>
        <li><a href="../colophon.html">Colophon</a></li>
      </ul>
    </div>
  </div>
  <div class="bulma-has-text-centered">
    <div>Find us on ...</div>
    <div class="bulma-is-size-3">
      <a class="bulma-icon bulma-is-large bulma-has-text-current" href="https://github.com/typelevel">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM252.8 8c-138.7 0-244.8 105.3-244.8 244 0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1 100-33.2 167.8-128.1 167.8-239 0-138.7-112.5-244-251.2-244zM105.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
      <a class="bulma-icon bulma-is-large bulma-has-text-current" href="https://discord.gg/typelevel-632277896739946517">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1 .1s-.6 .4-.8 .8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2c-41.3 7.1-81.6 19.6-119.7 37.1-.3 .1-.6 .4-.8 .7-76.2 113.8-97.1 224.9-86.9 334.5 0 .3 .1 .5 .2 .8s.3 .4 .5 .6c44.4 32.9 94 58 146.8 74.2 .4 .1 .8 .1 1.1 0s.7-.4 .9-.7c11.3-15.4 21.4-31.8 30-48.8 .1-.2 .2-.5 .2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6 .2-.9 .3-.5 .6-.7c3.1-2.3 6.2-4.7 9.1-7.1 .3-.2 .6-.4 .9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1 .7-.2 1-.2s.7 .2 .9 .4c2.9 2.4 6 4.9 9.1 7.2 .2 .2 .4 .4 .6 .7s.2 .6 .2 .9-.1 .6-.3 .9-.4 .5-.6 .6c-14.7 8.6-30 15.9-45.9 21.8-.2 .1-.5 .2-.7 .4s-.3 .4-.4 .7-.1 .5-.1 .8 .1 .5 .2 .8c8.8 17 18.8 33.3 30 48.8 .2 .3 .6 .6 .9 .7s.8 .1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2 .2-.2 .4-.4 .5-.6s.2-.5 .2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2zm195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2z"/></svg>
      </a>
      <a class="bulma-icon bulma-is-large bulma-has-text-current" href="https://bsky.app/profile/typelevel.org">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M407.8 294.7c-3.3-.4-6.7-.8-10-1.3 3.4 .4 6.7 .9 10 1.3zM288 227.1C261.9 176.4 190.9 81.9 124.9 35.3 61.6-9.4 37.5-1.7 21.6 5.5 3.3 13.8 0 41.9 0 58.4S9.1 194 15 213.9c19.5 65.7 89.1 87.9 153.2 80.7 3.3-.5 6.6-.9 10-1.4-3.3 .5-6.6 1-10 1.4-93.9 14-177.3 48.2-67.9 169.9 120.3 124.6 164.8-26.7 187.7-103.4 22.9 76.7 49.2 222.5 185.6 103.4 102.4-103.4 28.1-156-65.8-169.9-3.3-.4-6.7-.8-10-1.3 3.4 .4 6.7 .9 10 1.3 64.1 7.1 133.6-15.1 153.2-80.7 5.9-19.9 15-138.9 15-155.5s-3.3-44.7-21.6-52.9c-15.8-7.1-40-14.9-103.2 29.8-66.1 46.6-137.1 141.1-163.2 191.8z"/></svg>
      </a>
      <a class="bulma-icon bulma-is-large bulma-has-text-current" href="https://fosstodon.org/@typelevel">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M433 179.1c0-97.2-63.7-125.7-63.7-125.7-62.5-28.7-228.6-28.4-290.5 0 0 0-63.7 28.5-63.7 125.7 0 115.7-6.6 259.4 105.6 289.1 40.5 10.7 75.3 13 103.3 11.4 50.8-2.8 79.3-18.1 79.3-18.1l-1.7-36.9s-36.3 11.4-77.1 10.1c-40.4-1.4-83-4.4-89.6-54-.6-4.6-.9-9.3-.9-13.9 85.6 20.9 158.7 9.1 178.7 6.7 56.1-6.7 105-41.3 111.2-72.9 9.8-49.8 9-121.5 9-121.5zM357.9 304.3l-46.6 0 0-114.2c0-49.7-64-51.6-64 6.9l0 62.5-46.3 0 0-62.5c0-58.5-64-56.6-64-6.9l0 114.2-46.7 0c0-122.1-5.2-147.9 18.4-175 25.9-28.9 79.8-30.8 103.8 6.1l11.6 19.5 11.6-19.5c24.1-37.1 78.1-34.8 103.8-6.1 23.7 27.3 18.4 53 18.4 175l0 0z"/></svg>
      </a>
      <a class="bulma-icon bulma-is-large bulma-has-text-current" href="https://www.youtube.com/@typelevel">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M549.7 124.1C543.5 100.4 524.9 81.8 501.4 75.5 458.9 64 288.1 64 288.1 64S117.3 64 74.7 75.5C51.2 81.8 32.7 100.4 26.4 124.1 15 167 15 256.4 15 256.4s0 89.4 11.4 132.3c6.3 23.6 24.8 41.5 48.3 47.8 42.6 11.5 213.4 11.5 213.4 11.5s170.8 0 213.4-11.5c23.5-6.3 42-24.2 48.3-47.8 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232.2 337.6l0-162.4 142.7 81.2-142.7 81.2z"/></svg>
      </a>
      <a class="bulma-icon bulma-is-large bulma-has-text-current"
        href="https://linkedin.com/company/typelevel-foundation">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M416 32L31.9 32C14.3 32 0 46.5 0 64.3L0 447.7C0 465.5 14.3 480 31.9 480L416 480c17.6 0 32-14.5 32-32.3l0-383.4C448 46.5 433.6 32 416 32zM135.4 416l-66.4 0 0-213.8 66.5 0 0 213.8-.1 0zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77zM384.3 416l-66.4 0 0-104c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9l0 105.8-66.4 0 0-213.8 63.7 0 0 29.2 .9 0c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9l0 117.2z"/></svg>
      </a>
      <a class="bulma-icon bulma-is-large bulma-has-text-current"
        href="feed.rss">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc. --><path fill="currentColor" d="M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32zM96 136c0-13.3 10.7-24 24-24 137 0 248 111 248 248 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24 83.9 0 152 68.1 152 152 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104-13.3 0-24-10.7-24-24zm0 120a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"/></svg>
      </a>
    </div>
  </div>
</footer>

</body>

</html>

